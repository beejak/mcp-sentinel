# Simple Docker Compose for MCP Sentinel (Phase 3)
# Use this for quick scanning without enterprise infrastructure
#
# Usage:
#   docker-compose -f docker-compose.simple.yml up --build
#   docker-compose -f docker-compose.simple.yml run scanner scan /data
#
# This configuration provides:
# - Lightweight scanning container
# - Volume mounting for local projects
# - All 4 report formats (Terminal, JSON, SARIF, HTML)

version: '3.8'

services:
  # Standalone Scanner
  scanner:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mcp-sentinel-scanner
    volumes:
      # Mount your project directory here
      - ./data:/data:ro              # Read-only project files
      - ./reports:/reports            # Output reports
      # Mount your .mcp-sentinel.yaml config (optional)
      - ./.mcp-sentinel.yaml:/app/.mcp-sentinel.yaml:ro
    environment:
      # Logging
      LOG_LEVEL: ${LOG_LEVEL:-info}

      # AI Providers (optional, for Phase 4+)
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      GOOGLE_API_KEY: ${GOOGLE_API_KEY:-}

    # Override command for interactive use
    # Use: docker-compose -f docker-compose.simple.yml run scanner scan /data --output html --json-file /reports/report.html
    command: ["mcp-sentinel", "--help"]

    networks:
      - mcp-network

networks:
  mcp-network:
    driver: bridge

# Example commands:
#
# 1. Scan with terminal output:
#    docker-compose -f docker-compose.simple.yml run --rm scanner scan /data
#
# 2. Generate HTML report:
#    docker-compose -f docker-compose.simple.yml run --rm scanner scan /data --output html --json-file /reports/report.html
#
# 3. Generate SARIF for GitHub:
#    docker-compose -f docker-compose.simple.yml run --rm scanner scan /data --output sarif --json-file /reports/results.sarif
#
# 4. Scan with severity filtering:
#    docker-compose -f docker-compose.simple.yml run --rm scanner scan /data --severity critical --severity high --output html --json-file /reports/critical.html
#
# 5. Initialize config:
#    docker-compose -f docker-compose.simple.yml run --rm scanner init
